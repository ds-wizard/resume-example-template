{# This is the template starter file generated by DSW TDK #}
{%- set km = ctx.knowledgeModel -%}
{%- set repliesMap = ctx.questionnaireReplies -%}
{%- set chapterBasicUUID = "092596cd-b3ff-42a5-90dc-1698ebe7e74e" -%}
{%- set qFirstnameUUID = "90a46761-1d22-4f74-b3c7-aab3fba3efb8" -%}
{%- set qLastnameUUID = "9936cc0a-b62b-48fd-b9be-c3a768545d96" -%}
{%- set qFirstnamePath = [chapterBasicUUID, qFirstnameUUID]|reply_path -%}
{%- set qLastnamePath = [chapterBasicUUID, qLastnameUUID]|reply_path -%}
{%- set firstname = repliesMap[qFirstnamePath]|reply_str_value -%}
{%- set lastname = repliesMap[qLastnamePath]|reply_str_value -%}
{%- set qGenderUUID = "1e5eb700-6233-4dd1-9862-9646aeefd479" -%}
{%- set qGenderPath = [chapterBasicUUID, qGenderUUID]|reply_path -%}
{%- set gender = repliesMap[qGenderPath]|reply_str_value -%}
{%- set aGenderMaleUUID = "cd651988-1e2f-4369-8c9a-0690911ef5e8" -%}
{%- set aGenderFemaleUUID = "50e469ab-2922-41b7-8f3b-e154815cdf4c" -%}
{%- set aGenderOtherUUID = "f208b35c-6561-4288-b339-da513a7bb307" -%}
{%- set qGenderOtherUUID = "7dfad87e-86ea-41e0-84d6-d912c9f722ae" -%}
{%- set qGenderOtherPath = [qGenderPath, aGenderOtherUUID, qGenderOtherUUID]|reply_path -%}
{%- set genderOther = repliesMap[qGenderOtherPath]|reply_str_value -%}
{# SKILLS #}
{%- set chapterSkillsUUID = "089ea857-16ac-44df-b4e6-f0e4065f25d9" -%}
{%- set qSkillsUUID = "196073ed-05a0-4937-be46-0118f97cc564" -%}
{%- set qSkillsPath = [chapterSkillsUUID, qSkillsUUID]|reply_path -%}
{%- set skills = repliesMap[qSkillsPath]|reply_items -%}
{%- set qSkillNameUUID = "06090290-95dc-4411-9d15-ac8d00c84503" -%}
{# languages #}
{%- set qLanguagesUUID = "c2e4a6af-5036-4237-bdba-9ce7a1db61a1" -%}
{%- set qLanguagesPath = [chapterSkillsUUID, qLanguagesUUID]|reply_path -%}
{%- set languages = repliesMap[qLanguagesPath]|reply_items -%}
{%- set qLanguageUUID = "958b2f2d-8623-4743-a35f-ffdb98cd5045" -%}
<!DOCTYPE html>
<html>
  <head>
    <title>Resume</title>
    <meta charset="utf-8">
  </head>
  <body>
    {% if firstname or lastname %}
      <h1>Resume of {{ firstname }} {{ lastname }}</h1>
    {% else %}
      <h1>Resume of anonymous person</h1>
    {% endif %}

    {% if gender == aGenderMaleUUID %}
      <p>He is a man.</p>
    {% elif gender == aGenderFemaleUUID %}
      <p>She is a woman.</p>
    {% elif gender == aGenderOtherUUID %}
      <p>It uses a different gender: {{ genderOther }}</p>
    {% else %}
      <p>Prefers not to state own gender.<p>
    {% endif %}

    <h2>Skills</h2>

    <ul>
      {% for skillUUID in skills %}
        {% set qSkillNamePath = [qSkillsPath, skillUUID, qSkillNameUUID]|reply_path %}
        {% set skillName = repliesMap[qSkillNamePath]|reply_str_value %}
        {% if skillName %}
          <li>{{ skillName }}</li>
        {% endif %}
      {% endfor %}
    </ul>

    <h2>Languages</h2>
    <ul>
      {% set languageQuestion = km.entities.questions[qLanguageUUID] %}
      {% set languageIntegration = km.entities.integrations[languageQuestion.integrationUuid] %}
      {% for languageUUID in languages %}
        {% set qLanguagePath = [qLanguagesPath, languageUUID, qLanguageUUID]|reply_path %}
        {% set languageReply = repliesMap[qLanguagePath] %}
        {% if languageReply %}
          {% if languageReply.value.type == "IntegrationValue" %}
            {% set languageLink = languageIntegration.itemUrl|replace("${id}", languageReply.value.id) %}
            <li><a href="{{ languageLink }}" target="_blank">{{ languageReply.value.value }}</a></li>
          {% else %}
            <li>{{ languageReply.value.value }}</li>
          {% endif %}
        {% endif %}
      {% endfor %}
    </ul>

    <hr>

    <ol>
    {% for chapterUuid in km.chapterUuids %}
      {% set chapter = km.entities.chapters[chapterUuid] %}
      <li>{{ chapter.title }}
      <ol>
      {% for questionUuid in chapter.questionUuids %}
        {% set question = km.entities.questions[questionUuid] %}
        {% set reply = repliesMap[[chapterUuid, questionUuid]|reply_path] %}
        <li>{{ question.title }} {% if reply %}✔️{% else %}❌{% endif %}</li>
      {% endfor %}
      </ol>
      </li>
    {% endfor %}
    </ol>

  </body>
</html>
